/**
 * Package: amarkal
 * Version: 0.3.6
 * Date: 2015-04-27
 */
function Amarkal(){}+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.3.4",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c&&c.$tip&&c.$tip.is(":visible")?void(c.hoverState="in"):(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),jQuery(document).ready(function(a){Amarkal.Utility=function(){},Amarkal.Utility.arrayReplace=function(a,b){for(var c=b,d=0;d<a.length;d++)c=c.replace(a[d][0],a[d][1]);return c},Amarkal.Utility.extend=function(b,c){return a.extend({},b,c)},Amarkal.Notifier={},Amarkal.Notifier.top=32,Amarkal.Notifier.notifications=[],Amarkal.Notifier.notify=function(b,c){var d=document.createElement("div"),e=document.createElement("p"),f=document.createElement("div");d.setAttribute("class","ao-notification notifier-"+c),f.setAttribute("class","ao-notification-button fa fa-times"),d.appendChild(e),d.appendChild(f),e.innerHTML=b,a(f).click(function(){Amarkal.Notifier.removeNotification(d)}),a(d).css({top:Amarkal.Notifier.top+"px"}),a(".amarkal-options").append(d),Amarkal.Notifier.top+=a(d).outerHeight()+10,Amarkal.Notifier.notifications.push(d)},Amarkal.Notifier.success=function(a){Amarkal.Notifier.notify(a,"success")},Amarkal.Notifier.error=function(a){Amarkal.Notifier.notify(a,"error")},Amarkal.Notifier.removeNotification=function(b){var c=Amarkal.Notifier.notifications.indexOf(b),d=a(b).outerHeight()+10;for(Amarkal.Notifier.top-=d,b.parentNode.removeChild(b),Amarkal.Notifier.notifications.splice(c,1);c<Amarkal.Notifier.notifications.length;c++)a(Amarkal.Notifier.notifications[c]).animate({top:"-="+d})},Amarkal.Options={},Amarkal.Options.formID="ao-form",Amarkal.Options.init=function(){Amarkal.Options.Sections.init(),a(".form-control-button").click(function(b){b.preventDefault(),b.stopPropagation(),Amarkal.Options[a(this).attr("data-action")]()});for(var b=Amarkal.Options.State.get("notifications"),c=0;c<b.length&&b;c++)Amarkal.Notifier.notify(b[c].message,b[c].type);for(var d=Amarkal.Options.State.get("errors"),c=0;c<d.length&&d;c++){var e=Amarkal.Options.Sections.getByID(d[c].section);e.addNotification(d[c].message)}a(".amarkal-options .append-control-menu").click(function(b){b.preventDefault(),b.stopPropagation(),a(this).parent().hasClass("active")?a(".form-control-button").removeClass("active"):(a(".form-control-button").removeClass("active"),a(this).parent().toggleClass("active"))}),a('[data-type="help"]').tooltip({delay:{show:0,hide:250}})},Amarkal.Options.save=function(){Amarkal.Options.State.set("action","save"),Amarkal.Options.submit()},Amarkal.Options.reset=function(){Amarkal.Options.State.set("action","reset-all"),Amarkal.Options.submit()},Amarkal.Options.resetSection=function(){Amarkal.Options.State.set("action","reset-section"),Amarkal.Options.submit()},Amarkal.Options.export=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.exportAs=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.import=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.submit=function(){a("#"+Amarkal.Options.formID).submit()},Amarkal.Options.Section=function(b){this.id=b,this.button=a('[data-section="'+this.id+'"]'),this.triangleEl=a('<i class="fa fa-exclamation-triangle"></i>'),this.circleEl=a('<span class="number"></span>'),this.noticePanel=a("#"+b).find(".section-notifications"),this.notices=[],this.updated=[],this.subsections=[],this.init()},Amarkal.Options.Section.prototype.init=function(){this.button.append(this.triangleEl,this.circleEl),this.circleEl.hide(),this.triangleEl.hide();var b=this;a("#"+this.id).find(".field-wrapper").change(function(){a(this).addClass("field-updated"),b.updated.push(a(this).attr("for")),a.unique(b.updated),b.circleEl.text(b.updated.length),b.circleEl.show()}),a("#"+this.id+" .sub-menu a").each(function(){a(this).click(function(c){c.preventDefault(),b.hideAllSubsections(),b.showSubsection(a(this).attr("href"))}),b.subsections.push(a(this).attr("href"))}),this.hideAllSubsections(),this.showSubsection(this.subsections[0])},Amarkal.Options.Section.prototype.show=function(){Amarkal.Options.State.set("active_section",this.id),this.button.addClass("active"),a("#"+this.id).show(),Amarkal.UI.refresh()},Amarkal.Options.Section.prototype.hide=function(){this.button.removeClass("active"),a("#"+this.id).hide()},Amarkal.Options.Section.prototype.showSubsection=function(b){a('[href="'+b+'"]').addClass("active"),a('[data-subsection="'+b+'"]').show(),Amarkal.UI.refresh()},Amarkal.Options.Section.prototype.hideAllSubsections=function(){a("#"+this.id+" .sub-menu a").each(function(){a(this).removeClass("active"),a('[data-subsection="'+a(this).attr("href")+'"]').hide()})},Amarkal.Options.Section.prototype.addNotification=function(a){this.notices.push(a),this.triangleEl.show();for(var b="",c=0;c<this.notices.length;c++)b+="<p>"+this.notices[c]+"</p>";this.noticePanel.html(b)},Amarkal.Options.Section.prototype.clearNotifications=function(){this.triangleEl.hide(),this.notices=[]},Amarkal.Options.Sections={},Amarkal.Options.Sections.sectionList=[],Amarkal.Options.Sections.init=function(){a(".amarkal-options .section").each(function(){var b=new Amarkal.Options.Section(a(this).attr("id"));Amarkal.Options.Sections.sectionList.push(b),b.hide(),b.id===Amarkal.Options.State.get("active_section")&&b.show()}),a("[data-section]").click(function(b){b.preventDefault(),Amarkal.Options.Sections.hideAll(),Amarkal.Options.Sections.getByID(a(this).attr("data-section")).show(),a("#"+Amarkal.Options.formID).attr("action",a(this).attr("href"))})},Amarkal.Options.Sections.getByID=function(a){for(var b=0;b<Amarkal.Options.Sections.sectionList.length;b++){var c=Amarkal.Options.Sections.sectionList[b];if(c.id===a)return c}},Amarkal.Options.Sections.hideAll=function(){for(var a=0;a<Amarkal.Options.Sections.sectionList.length;a++)Amarkal.Options.Sections.sectionList[a].hide()},Amarkal.Options.State={},Amarkal.Options.State.inputID="options-state",Amarkal.Options.State.data=a.parseJSON(a("#"+Amarkal.Options.State.inputID).val()),Amarkal.Options.State.set=function(a,b){Amarkal.Options.State.data[a]=b,Amarkal.Options.State.update()},Amarkal.Options.State.get=function(a){var b=Amarkal.Options.State.data;return null!==b&&b.hasOwnProperty(a)?b[a]:!1},Amarkal.Options.State.update=function(){a("#options-state").val(JSON.stringify(Amarkal.Options.State.data))},Amarkal.UI={},Amarkal.UI.components=[],Amarkal.UI.init=function(){for(var b=0;b<Amarkal.UI.components.length;b++){var c=Amarkal.UI.components[b];a(c.wrapper).each(function(){c.init(this),a(c.getInput(this)).change(function(){var b=a(this).parents(".afw-ui-component");b.trigger("change"),b.attr("data-value",a(this).val())})})}},Amarkal.UI.register=function(a){Amarkal.UI.components.push(a)},Amarkal.UI.setValue=function(b,c){for(var d=0;d<Amarkal.UI.components.length;d++)a(b).hasClass(Amarkal.UI.components[d].wrapper.replace(".",""))&&Amarkal.UI.components[d].setValue(b,c)},Amarkal.UI.getComponent=function(b){for(var c=0;c<Amarkal.UI.components.length;c++)if(a(b).hasClass(Amarkal.UI.components[c].wrapper.replace(".","")))return Amarkal.UI.components[c];return null},Amarkal.UI.refresh=function(){a.each(Amarkal.UI.components,function(a,b){b.hasOwnProperty("onShow")&&b.onShow()})},Amarkal.UI.register({wrapper:".afw-ui-component-checkbox",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).value=c,values=c.split(","),a(b).children("label").each(function(){var b=a(this).children("input");b.prop("checked",a.inArray(b.val(),values)>-1)})},init:function(b){a(b).children("label").click(function(){var c=[],d=a(this).parent(),e=d.children("input");a(b).hasClass("afw-ui-component-disabled")||(d.find(":checked").each(function(){c.push(a(this).val())}),e.val(c),e.trigger("change"))})}}),Amarkal.UI.register({wrapper:".afw-ui-component-code-editor",getInput:function(b){return a(b).children("textarea")},setValue:function(b,c){a(b).attr("data-value",c),this.getEditor(a(b).children(".afw-ui-ace-editor")[0]).setValue(c,1)},setMode:function(b,c){this.getEditor(a(b).children(".afw-ui-ace-editor")[0]).getSession().setMode("ace/mode/"+c)},getEditor:function(a){for(var b=0;b<this.editors.length;b++)if(this.editors[b].container===a)return this.editors[b];throw"Amarkal Framework: Ace editor could not be found"},init:function(b){var c=a(b).children(".afw-ui-ace-editor"),d=c.attr("data-theme"),e=c.attr("data-lang"),f=ace.edit(c[0]);if(this.editors.push(f),ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/"),f.setTheme("ace/theme/"+d),f.getSession().setMode("ace/mode/"+e),f.setOptions({maxLines:1/0}),c.hasClass("afw-ui-ace-editor-disabled"))return void f.setReadOnly(!0);var g=this;c.keyup(function(){a(this).parent().attr("data-value",f.getValue()),g.getInput(b).val(f.getValue())})},editors:[],onShow:function(){for(var a=0;a<this.editors.length;a++)this.editors[a].resize(),this.editors[a].renderer.updateFull()}}),Amarkal.UI.register({wrapper:".afw-ui-composite-component",getInput:function(b){return a(b).children("input")},setValue:function(){throw"Composite components cannot dynamically change value"},init:function(b){a(b).find(".afw-ui-component").change(function(){var b=a(this).parent().parent().children("input"),c=a(this).parent().parent().find(".afw-ui-component"),d=b.attr("data-template");b.val(d);for(var e=0;e<c.length;e++){var f=b.val(),g=a(c[e]);b.val(f.replace("<% "+g.attr("data-name")+" %>",g.attr("data-value")))}})}}),Amarkal.UI.register({wrapper:".afw-ui-component-content",getInput:function(){return!1},setValue:function(){},init:function(){},onShow:function(){a(this.wrapper).each(function(){if(a(this).hasClass("afw-ui-component-ajaxified")&&a(this).is(":visible")){var b=a(this).find(".afw-ui-iframe");b.height(b.contents().find("html").outerHeight())}})}}),Amarkal.UI.register({wrapper:".afw-ui-component-dropdown",getInput:function(b){return a(b).children("select")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).select2("val",c)},init:function(b){this.getInput(b).select2({width:"resolve"}).change(function(){a(this).parents(".afw-ui-component").trigger("change")})}}),Amarkal.UI.register({wrapper:".afw-ui-component-progressbar",getInput:function(){return!1},setValue:function(b,c){var d=a(b).find(".progressbar"),e=parseFloat(d.attr("data-max")),f=c/e*100;a(b).find(".progressbar-inner").css({width:f+"%"}),a(b).find(".progressbar-label").text(c+"/"+e)},init:function(b){var c=a(b).find(".progressbar"),d=parseFloat(c.attr("data-value")),e=parseFloat(c.attr("data-max")),f=d/e*100,g=a("<div></div>"),h=a("<div></div>"),i=a("<div></div>");g.addClass("progressbar-outer"),h.addClass("progressbar-inner").css({width:f+"%"}),i.addClass("progressbar-label").text(d+"/"+e),g.append(h),c.append(g,i)}}),Amarkal.UI.register({wrapper:".afw-ui-component-slider",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),"range"===a(b).attr("data-type")?a(b).find(".slider").slider("values",c):a(b).find(".slider").slider("value",c)},init:function(b){var c=parseFloat(a(b).attr("data-max")),d=parseFloat(a(b).attr("data-min")),e=parseFloat(a(b).attr("data-step")),f=a(b).attr("data-type"),g=a(b).hasClass("afw-ui-component-disabled");if("range"===f){var h=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:!0,disabled:g,values:[parseInt(h[0].value),parseInt(h[1].value)],slide:function(a,b){h[0].value=b.values[0],h[1].value=b.values[1],h.trigger("change")}})}else{var i=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:f,disabled:g,value:parseInt(i.val()),slide:function(a,b){i.val(b.value),i.trigger("change")}})}a(b).find(".ui-slider-handle").html('<i class="fa fa-navicon fa-rotate-90"></i>')}}),Amarkal.UI.register({wrapper:".afw-ui-component-spinner",getInput:function(b){return a(b).find("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).spinner("value",c)},init:function(b){var c=this.getInput(b),d=c.attr("data-max"),e=c.attr("data-min"),f=c.attr("data-step"),g=c.attr("disabled");c.spinner({min:e,max:d,step:f,disabled:g}),a(b).find(".ui-spinner-down").detach().insertBefore(c),a(b).find(".ui-spinner-up").html('<i class="fa fa-chevron-right"></i>'),a(b).find(".ui-spinner-down").html('<i class="fa fa-chevron-left"></i>'),a(b).find(".ui-spinner-button").click(function(){c.trigger("change")})}}),Amarkal.UI.register({wrapper:".afw-ui-component-text",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(b){this.getInput(b).keyup(function(){a(this).parent().attr("data-value",a(this).val())})}}),Amarkal.UI.register({wrapper:".afw-ui-component-textarea",getInput:function(b){return a(b).find("textarea")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(b){this.getInput(b).resizable({minHeight:150,minWidth:250}),a(b).find(".ui-resizable-s").html('<i class="fa fa-bars"></i>'),a(b).find(".ui-resizable-e").html('<i class="fa fa-bars fa-rotate-90"></i>')}}),Amarkal.UI.register({wrapper:".afw-ui-component-togglebutton",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c),values=c.split(","),a(b).children("label").each(function(){a.inArray(a(this).attr("data-value"),values)>-1?a(this).addClass("active"):a(this).removeClass("active")})},init:function(b){a(b).children("label").click(function(){var b=[],c=a(this).parent(),d=c.children("input");d.attr("disabled")||("false"===c.attr("data-multivalue")&&c.find("label").removeClass("active"),a(this).toggleClass("active"),c.find(".active").each(function(){b.push(a(this).attr("data-value"))}),d.val(b),d.trigger("change"))})}}),Amarkal.UI.register({wrapper:".afw-ui-component-wp-attachment",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).value=c},init:function(b){function c(c){a(b).children(".afw-ui-wp-attachments").html(""),c.map(function(c){a(b).children(".afw-ui-wp-attachments").append('<div class="afw-ui-wp-attachment"><img src="'+c+'"></div>')})}var d,e=this.getInput(b),f=a(b).attr("data-uploader-title"),g=a(b).attr("data-uploader-button-text"),h=a(b).hasClass("afw-ui-component-disabled"),i=a(b).hasClass("afw-wp-multi-attachment")?"add":!1;a(b).find(".afw-ui-attachment-button, .afw-ui-wp-attachments").click(function(a){if(a.preventDefault(),!h){if(d)return void d.open();d=wp.media.frames.file_frame=wp.media({title:f,button:{text:g},multiple:i}),d.on("open",function(){var a=e.val();if(!1!==i)for(var b=a.split(","),c=0;c<b.length;c++){var f=wp.media.attachment(b[c]);f.fetch(),d.state().get("selection").add(f)}else{var f=wp.media.attachment(a);f.fetch(),d.state().get("selection").add(f)}}),d.on("select",function(){var a=d.state().get("selection");if(!1!==i){var b=[],f=[];a.map(function(a){""!==a.id&&(a=a.toJSON(),b.push(a.id),f.push("image"===a.type?a.url:a.icon))}),c(f),e.val(b.join(","))}else{var g=a.first().toJSON(),h="image"===g.type?g.url:g.icon;c([h]),e.val(g.id)}e.trigger("change")}),d.open()}})}}),Amarkal.UI.register({wrapper:".afw-ui-component-wp-editor",getInput:function(b){return a(b).find("textarea")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(){}}),Amarkal.Editor={},Amarkal.Editor.FloatingToolbar=function(a,b){this.settings=b,this.editor=a,this.init()},Amarkal.Editor.FloatingToolbar.prototype.init=function(){function a(a){return!(!e.dom.getAttrib(a,"data-mce-placeholder")&&!e.dom.getAttrib(a,"data-mce-object"))}function b(a){return a&&(tinymce.$(a).is(j.settings.selector)||0!==tinymce.$(a).parents(j.settings.selector).length)}function c(){i||d.hide()}for(var d,e=this.editor,f=tinymce.DOM,g=(e.settings,tinymce.ui.Factory),h=tinymce.Env.iOS,i=!0,j=this,k=tinymce.$("#postdivrich"),l=this.settings.buttons.length;l--;){var m=this.settings.buttons[l];e.addButton(m.slug,{tooltip:m.tooltip,icon:m.icon,onclick:m.onclick})}d=g.create(this.toolbarConfig()).renderTo(document.body).hide(),d.reposition=function(){var a,c,d,g,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this.getEl(),B=5,C=8,D=0,E=e.selection.getNode();return b(E)?(tinymce.$(E).is(j.settings.selector)||(E=tinymce.$(E).parents(j.settings.selector)[0]),i=window.pageYOffset||document.documentElement.scrollTop,k=tinymce.$("#wpadminbar")[0],l=tinymce.$(".mce-tinymce .mce-toolbar-grp")[0],m=E.getBoundingClientRect(),n=(m.left+m.right)/2,o=(m.top+m.bottom)/2,p=m.top,q=x-m.bottom,r=window.innerWidth,s=A.offsetWidth,t=s/2,u=e.getContentAreaContainer().firstChild,v=f.getPos(u),w=u.offsetWidth,x=u.offsetHeight,y=A.offsetHeight,z=y+C+B,h?a=m.top+v.y+C:p>=z?(g=" mce-arrow-down",a=m.top+v.y-y-C):q>=z?(g=" mce-arrow-up",a=m.bottom+v.y):(a=B,g=o>=z?" mce-arrow-down":" mce-arrow-up"),d=l?f.getPos(l).y+l.clientHeight:v.y,i&&(k&&0===k.getBoundingClientRect().top&&(D=k.clientHeight),i+D>d&&(d=i+D)),a&&d&&d+B>a&&(a=d+B,g=""),c=n-t,c+=v.x,s>=r?(g+=" mce-arrow-full",c=0):0>c&&m.left+s>r||c+s>r&&m.right-s<0?c=(r-s)/2:c<v.x?(g+=" mce-arrow-left",c=m.left+v.x):c+s>w+v.x&&(g+=" mce-arrow-right",c=m.right-s+v.x),h||(A.className=A.className.replace(/ ?mce-arrow-[\w]+/g,""),A.className+=g),f.setStyles(A,{left:c,top:a}),this):this},h&&e.on("click",function(a){if(b(c)){var c=a.target;window.setTimeout(function(){e.selection.select(c)},200)}else d.hide()}),e.on("nodechange",function(c){var f=h?350:100;return!b(c.element)||a(c.element)?void d.hide():void setTimeout(function(){var c=e.selection.getNode();b(c)&&!a(c)?d._visible?d.reposition():d.show():d.hide()},f)}),d.on("show",function(){i=!1,this._visible&&(this.reposition(),f.addClass(this.getEl(),"mce-inline-toolbar-grp-active"))}),d.on("hide",function(){i=!0,f.removeClass(this.getEl(),"mce-inline-toolbar-grp-active")}),d.on("keydown",function(a){27===a.keyCode&&(c(),e.focus())}),f.bind(window,"resize scroll",function(){!i&&k.hasClass("wp-editor-expand")&&c()}),e.on("init",function(){e.dom.bind(e.getWin(),"scroll",c)}),e.on("blur hide",c),e.shortcuts.add("Alt+119","",function(){var a=d.find("toolbar")[0];a&&a.focus(!0)})},Amarkal.Editor.FloatingToolbar.prototype.toolbarConfig=function(){var a,b=[],c=tinymce.ui.Factory,d=this.editor,e=d.settings;return tinymce.each(this.settings.buttons,function(f){function g(){var a=d.selection;i.settings.stateSelector&&a.selectorChanged(i.settings.stateSelector,function(a){i.active(a)},!0),i.settings.disabledStateSelector&&a.selectorChanged(i.settings.disabledStateSelector,function(a){i.disabled(a)})}var h,i=f.slug;"|"===i?a=null:c.has(i)?(i={type:i},e.toolbar_items_size&&(i.size=e.toolbar_items_size),b.push(i),a=null):(a||(a={type:"buttongroup",items:[]},b.push(a)),d.buttons[i]&&(h=i,i=d.buttons[h],"function"==typeof i&&(i=i()),i.type=i.type||"button",e.toolbar_items_size&&(i.size=e.toolbar_items_size),i=c.create(i),a.items.push(i),d.initialized?g():d.on("init",g)))}),{type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp wp-image-toolbar",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:b}]}},Amarkal.Editor.Form=function(){},Amarkal.Editor.Form.open=function(b,c){var d=Amarkal.Utility.extend(Amarkal.Editor.Form.defaults(),c);b.windowManager.open({title:d.title,url:d.url,width:d.width,height:d.height,buttons:[{text:"Insert",classes:"widget btn primary first abs-layout-item",disabled:!1,onclick:function(){var c=a('iframe[src$="'+d.url+'"]').contents(),e={};c.find(".afw-ui-component").each(function(){var b=a(this).attr("data-name"),c="undefined"==a(this).attr("data-value")?"":a(this).attr("data-value");e[b]=c}),d.on_insert(b,e),b.windowManager.close()}},{text:"Close",onclick:function(){b.windowManager.close()}}]},d)},Amarkal.Editor.Form.defaults=function(){return{title:"",url:"",width:500,height:500,template:"",on_init:function(){},on_insert:function(a,b){var c=a.windowManager.getParams();a.insertContent(Amarkal.Editor.Form.parseTemplate(c.template,b))},values:{}}},Amarkal.Editor.Form.init=function(){var b=a(".afw-editor-popup-form");if(0!==b.length){var c=top.tinymce.activeEditor.windowManager.getParams();this.setValues(),c.on_init(window)}},Amarkal.Editor.Form.setValues=function(){var b=top.tinymce.activeEditor.windowManager.getParams().values;"undefined"!=typeof b&&a(".afw-editor-popup-form").find(".afw-ui-component").each(function(){var c=a(this).attr("data-name");b.hasOwnProperty(c)&&Amarkal.UI.setValue(this,b[c])})},Amarkal.Editor.Form.parseTemplate=function(a,b){return a.replace(/(<%([^\%\<\>]*)%>)/g,function(a,c,d){return b[d.trim()]})},Amarkal.Widget={},Amarkal.Widget.init=function(){a("body").hasClass("widgets-php")&&(a(document).trigger("widget_init"),Amarkal.Widget.setAjaxListener(),a(document).bind("widget_init",function(){a('[data-type="help"]').tooltip({delay:{show:0,hide:250}}),Amarkal.UI.init()}))},Amarkal.Widget.setAjaxListener=function(){a(document).ajaxComplete(function(b,c,d){var e,f,g,h={},i=d.data.split("&");for(e in i)f=i[e].split("="),h[decodeURIComponent(f[0])]=decodeURIComponent(f[1]);h.action&&"save-widget"===h.action&&(g=a('input.widget-id[value="'+h["widget-id"]+'"]').parents(".widget"),c.responseText?a(document).trigger("widget_init",g):wpWidgets.save(g,0,1,0))})},Amarkal.Widget.init(),Amarkal.UI.init(),Amarkal.Options.init(),Amarkal.Editor.Form.init()});
